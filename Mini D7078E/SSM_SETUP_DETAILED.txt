================================================================================
DETAILED GUIDE: ADD SSM SUPPORT TO YOUR EC2 INSTANCES
================================================================================

OBJECTIVE:
Enable SSM (Systems Manager) on your ASG instances so FIS experiments can
target them and inject faults (CPU stress, stop, etc).

REGION: eu-north-1
ASG: D7078E-MINI-PROJECT-GROUP35-ASG
Launch Template: (to be identified)

TOTAL TIME: ~10 minutes

================================================================================
WHAT IS SSM AND WHY DO WE NEED IT?
================================================================================

SSM = AWS Systems Manager (part of AWS for remote management)

What it enables:
  âœ“ Run commands on EC2 instances (without SSH)
  âœ“ Execute scripts remotely (via AWS Console or CLI)
  âœ“ FIS can inject faults using SSM
  âœ“ No need for SSH access
  âœ“ Fully auditable (CloudTrail logs)

Requirements:
  1. EC2 instance must have IAM role with SSM permissions
  2. Role must have policy: AmazonSSMManagedInstanceCore
  3. SSM agent must run on instance (pre-installed on Amazon Linux 2, Ubuntu)

Your problem:
  âœ— Your instances have NO IAM role (or wrong role)
  âœ— FIS can't reach them â†’ experiments fail with "InvalidTarget"
  âœ— SSM operations fail with "not managed by SSM"

Solution:
  1. Create IAM role with SSM permissions
  2. Update Launch Template to use this role
  3. Terminate old instances
  4. ASG launches new instances with proper role
  5. FIS can now target them

================================================================================
PART 1: CREATE IAM ROLE FOR SSM
================================================================================

Step 1.1: Go to AWS IAM Console
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  URL: https://console.aws.amazon.com/iam/
  
  Or:
    1. AWS Console home
    2. Search box â†’ "IAM"
    3. Click "Identity and Access Management (IAM)"

Step 1.2: Navigate to Roles
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Left menu:
    â†’ Roles
    
  You should see a list of existing roles.

Step 1.3: Create New Role
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  1. Click "Create role" (orange button, top-right)
  
  2. Select trusted entity type:
     â””â”€ Service
  
  3. Select service:
     â””â”€ EC2 (in the "Use case" list below)
     â””â”€ Click on "EC2"
  
  4. Click "Next" (bottom right)

Step 1.4: Add Permissions
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  You're now on "Add permissions" step.
  
  Search for SSM policy:
    1. Search box: "AmazonSSMManagedInstanceCore"
    2. Find the policy checkbox
    3. âœ“ Check it
  
  Also add (optional but recommended):
    1. Search: "AmazonSSMPatchAssociation"
    2. âœ“ Check it
  
  Click "Next"

Step 1.5: Name the Role
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Role name: 
    â†’ D7078E-EC2-SSM-Role
  
  Description (optional):
    â†’ "Role for EC2 instances in D7078E mini project to use SSM"
  
  Click "Create role" (orange button)

Step 1.6: Verify Role Created
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  You should see green banner: "Role D7078E-EC2-SSM-Role created successfully"
  
  You now have:
    âœ“ Role: D7078E-EC2-SSM-Role
    âœ“ Policy: AmazonSSMManagedInstanceCore attached
    âœ“ Ready to use in Launch Template

================================================================================
PART 2: UPDATE LAUNCH TEMPLATE WITH NEW ROLE
================================================================================

Step 2.1: Go to EC2 Console
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  URL: https://eu-north-1.console.aws.amazon.com/ec2/
  
  Or:
    1. AWS Console home
    2. Search box â†’ "EC2"
    3. Click "EC2"
    4. Make sure region is "eu-north-1" (top-right)

Step 2.2: Find Your Launch Template
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Left menu:
    â†’ Instances â†’ Launch Templates
    
  OR use this direct search:
    1. Left menu â†’ "Launch Templates" (under "Instances")
    
  You should see a list. Find:
    â†’ D7078E-MINI-PROJECT-GROUP35-LT (or similar name)

Step 2.3: Open Launch Template for Editing
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  1. Click on your Launch Template name
  
  2. You'll see:
     â””â”€ Template name, ID, version info
     â””â”€ "Create Launch Template Version" button
     â””â”€ "Actions" dropdown menu
  
  3. Click "Actions" dropdown (top-right)
  
  4. Select: "Create new version"
     (This creates a new version without modifying existing instances)

Step 2.4: Edit Advanced Details
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  In the template editor, scroll down to:
    â†’ Advanced Details (expand this section)
  
  Look for:
    â†’ "IAM instance profile"
  
  This field is currently:
    â˜ Empty, OR
    â˜ Has a role that doesn't have SSM permissions

Step 2.5: Set IAM Instance Profile
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  1. Click "IAM instance profile" dropdown
  
  2. Search for: "D7078E-EC2-SSM-Role"
     (The role you just created)
  
  3. Select it
  
  Important:
    âš  The dropdown shows INSTANCE PROFILES, not roles directly
    âš  When you created the role, an instance profile with the same name was auto-created
    âš  Select "D7078E-EC2-SSM-Role" from the dropdown

Step 2.6: Save New Launch Template Version
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  1. Scroll to bottom
  
  2. Click "Create launch template version" (green button)
  
  3. You'll see: "Launch Template Version 2 created successfully"
  
  4. You now have:
     âœ“ Version 1: Old (no SSM role)
     âœ“ Version 2: New (with SSM role)

Step 2.7: Set New Version as Default
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  1. Go back to Launch Templates list
  
  2. Click on your Launch Template name
  
  3. You should see versions tab showing:
     â””â”€ Version 1 (original)
     â””â”€ Version 2 (new, with SSM role)
  
  4. Right-click Version 2 â†’ "Set as default"
     OR
     Select Version 2 â†’ Actions dropdown â†’ "Set as default"
  
  5. Confirm: Version 2 is now default âœ“

================================================================================
PART 3: TERMINATE OLD INSTANCES (CRITICAL!)
================================================================================

âš  IMPORTANT: You must terminate the old instances so ASG launches new ones
              with the updated Launch Template.

Step 3.1: Go to EC2 Instances
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  1. AWS Console â†’ EC2 â†’ Instances
  
  2. You should see your 3 instances (or however many you have):
     â””â”€ All in "Running" state
     â””â”€ Names matching your ASG or project

Step 3.2: Identify Your ASG Instances
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Look for instances with tags like:
    â†’ Name: "D7078E-MINI-PROJECT-GROUP35-WEBSRV-*"
    â†’ Tag: aws:autoscaling:groupName = D7078E-MINI-PROJECT-GROUP35-ASG
  
  These are your instances launched by the ASG.

Step 3.3: Select All ASG Instances
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Method A (Recommended): Select by ASG
    1. EC2 â†’ Auto Scaling Groups
    2. Select: D7078E-MINI-PROJECT-GROUP35-ASG
    3. Instances tab
    4. You'll see list of instances in this ASG
    5. Note their Instance IDs
  
  Method B: Select by checking boxes
    1. EC2 â†’ Instances
    2. â˜‘ Check all 3 instances from your ASG
    3. All checked = all selected

Step 3.4: Terminate Selected Instances
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  1. With instances selected (or in ASG view)
  
  2. Click "Instance State" dropdown (top menu)
     OR Right-click selected instances
  
  3. Select: "Terminate instances"
  
  4. Confirmation popup:
     "Are you sure you want to terminate these instances?"
     âœ“ Click "Terminate"
  
  5. Instances now showing state: "shutting-down" â†’ "terminated"

Step 3.5: What Happens Next
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  1. All old instances terminate (takes ~30 seconds)
  
  2. ASG detects instance count dropped below desired (3)
  
  3. ASG automatically launches NEW instances using:
     âœ“ Launch Template Version 2 (with SSM role!)
     âœ“ Same configuration as before
  
  4. New instances boot (takes ~1-2 minutes)
     â””â”€ State: Pending â†’ Running
     â””â”€ Status checks: Running â†’ Passed (both checks)
     â””â”€ Health: will show as "Healthy" in Target Group
  
  5. After ~2 minutes:
     â””â”€ 3 new instances running
     â””â”€ All with SSM role attached
     â””â”€ All managed by SSM
     â””â”€ Ready for FIS experiments!

Step 3.6: Verify New Instances Have SSM Role
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  1. EC2 â†’ Instances
  
  2. Click on one of the new instances
  
  3. Scroll down to "Details" tab
  
  4. Look for: "IAM role"
     â””â”€ Should show: D7078E-EC2-SSM-Role âœ“
  
  5. Verify all 3 new instances have this role

================================================================================
PART 4: VERIFY SSM CONNECTIVITY
================================================================================

Step 4.1: Check SSM Fleet Manager
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  1. AWS Console â†’ Systems Manager â†’ Fleet Manager
     (Or search "Fleet Manager")
  
  2. You should see your 3 instances listed
  
  3. Status should show: "Online" (green)
     â””â”€ If shows "Offline": wait 2-3 minutes and refresh
  
  This confirms:
    âœ“ SSM agent is running
    âœ“ Instance is managed by SSM
    âœ“ FIS can target it!

Step 4.2: Test SSM Connection (Optional)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  1. Systems Manager â†’ Session Manager
  
  2. Start session on one instance
  
  3. You should get a shell prompt (like SSH, but via SSM)
  
  4. Type: uptime
  
  5. You should see output (proves connection works)
  
  6. Type: exit (to close session)

================================================================================
PART 5: NOW YOU CAN USE FIS!
================================================================================

Now that instances have SSM role and are managed by SSM, FIS will work!

Step 5.1: Create FIS Experiment
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  1. AWS Console â†’ Fault Injection Simulator
  
  2. Create new experiment
  
  3. Configure:
     â”œâ”€ Name: "D7078E-Task5-CPU-Stress"
     â”œâ”€ Service: EC2
     â”œâ”€ Action: "Stop instances" OR "Increase CPU load"
     â”œâ”€ Target: Select your ASG instances
     â”‚  (FIS will now FIND them - no "InvalidTarget" error!)
     â”œâ”€ Duration: 120 seconds
     â””â”€ IAM role: Create role if needed
  
  4. Start experiment âœ“

Step 5.2: Expected Success
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  âœ“ Experiment starts (no "InvalidTarget" error!)
  âœ“ FIS injects fault on instance
  âœ“ Instance responds to fault
  âœ“ You observe failure and recovery in CloudWatch
  âœ“ After 120 seconds, fault ends
  âœ“ Instance recovers
  âœ“ ASG replaces it if needed

Step 5.3: Observe Task 5 Failure Simulation
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Follow the timeline from TASK_5_FAILURE_SIMULATION.txt:
  
    Minute 0: Fault starts
    Minute 0-1: Health check fails, CPU spikes (or instance stops)
    Minute 1-2: ASG launches replacement
    Minute 2-3: Replacement healthy, old instance terminates
    Minute 3+: System recovered with 3 healthy instances
  
  Collect evidence:
    âœ“ Screenshots of CloudWatch metrics
    âœ“ ASG Activity log
    âœ“ Target Group health transitions
    âœ“ EC2 Instances showing termination/launch

================================================================================
SUMMARY OF CHANGES
================================================================================

What you're doing:
  1. Create IAM role: D7078E-EC2-SSM-Role
     â””â”€ Attached policy: AmazonSSMManagedInstanceCore
  
  2. Update Launch Template Version 2
     â””â”€ IAM instance profile: D7078E-EC2-SSM-Role
  
  3. Terminate old instances (all 3)
     â””â”€ ASG automatically launches 3 new instances with new role
  
  4. Wait ~2 minutes for new instances to boot
  
  5. Verify instances are managed by SSM
     â””â”€ Systems Manager â†’ Fleet Manager â†’ See 3 "Online" instances
  
  6. Retry FIS experiment
     â””â”€ FIS can now find and target instances
     â””â”€ Experiment succeeds (no more "InvalidTarget" error)

What changed:
  âœ— Before: Instances had no SSM role â†’ FIS couldn't target them
  âœ“ After:  Instances have SSM role â†’ FIS can inject faults

Why this works:
  - EC2 instances need IAM role to be managed by SSM
  - Launch Template specifies which role new instances get
  - Old instances launch without role (problem)
  - New instances launch with role (solution)
  - FIS requires instances to be managed by SSM
  - Now FIS can target them successfully!

================================================================================
TIMELINE
================================================================================

Start: 0 min
  â””â”€ Create IAM role

+2 min: 2 min
  â””â”€ Update Launch Template

+3 min: 3 min
  â””â”€ Terminate old instances
  
+4 min: 4 min
  â””â”€ New instances start launching (Pending state)

+6 min: 6 min
  â””â”€ New instances Running
  â””â”€ Status checks starting

+8 min: 8 min
  â””â”€ All status checks passed
  â””â”€ Instances showing in Fleet Manager
  
+10 min: 10 min
  â””â”€ Ready to use FIS! âœ“
  â””â”€ Total time: ~10 minutes

================================================================================
TROUBLESHOOTING
================================================================================

Problem: Instances not showing in Fleet Manager after 10 minutes
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Solution:
    1. Verify IAM role is attached to instances
       â””â”€ EC2 â†’ Instances â†’ Click instance â†’ Details â†’ IAM role
       â””â”€ Should show: D7078E-EC2-SSM-Role
    
    2. Verify instance is fully Running
       â””â”€ State: running (not pending, stopping, etc)
    
    3. Verify instance security group allows SSM
       â””â”€ Usually not needed (SSM uses HTTPS, not inbound ports)
    
    4. Check CloudTrail for errors
       â””â”€ AWS Console â†’ CloudTrail â†’ Look for SSM-related errors
    
    5. Terminate and re-launch instance
       â””â”€ ASG will launch new one automatically
       â””â”€ Wait 5 minutes
       â””â”€ Retry

Problem: FIS still shows "InvalidTarget" error
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Solution:
    1. Verify instances are online in Fleet Manager
       â””â”€ AWS Console â†’ Systems Manager â†’ Fleet Manager
       â””â”€ All 3 should show "Online" status
    
    2. In FIS experiment, select instances explicitly
       â””â”€ Don't use tags/filters
       â””â”€ Click "Specify instances"
       â””â”€ Manually select each instance from dropdown
       â””â”€ All 3 instances should appear in list
    
    3. Make sure instances are in "Running" state
       â””â”€ Not Pending, Stopping, or Terminated
    
    4. Try running a test SSM command first
       â””â”€ Systems Manager â†’ Session Manager
       â””â”€ Start session on one instance
       â””â”€ If it works, FIS will work
       â””â”€ If it fails, troubleshoot SSM first

Problem: ASG didn't launch new instances
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Solution:
    1. Check ASG configuration
       â””â”€ EC2 â†’ Auto Scaling Groups â†’ Your ASG
       â””â”€ Desired capacity: should be 3
       â””â”€ Min: should be >= 1
    
    2. Check ASG Activity
       â””â”€ ASG â†’ Activity tab
       â””â”€ Should show "Launching 3 new instances"
       â””â”€ If no activity, manually increase desired capacity
    
    3. Wait 5 minutes and check again
       â””â”€ Instances take time to boot

Problem: Launch Template not updating
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Solution:
    1. Make sure you created a NEW VERSION
       â””â”€ Don't edit Version 1 directly
       â””â”€ Create Version 2 with IAM role
    
    2. Set Version 2 as DEFAULT
       â””â”€ Launch Templates â†’ Your template
       â””â”€ Right-click Version 2 â†’ "Set as default"
    
    3. Verify default version shows IAM role
       â””â”€ Template details â†’ Advanced details â†’ IAM instance profile
       â””â”€ Should show: D7078E-EC2-SSM-Role

================================================================================
NEXT STEPS
================================================================================

After verifying SSM is working:

1. Instances ready for FIS? âœ“
   â””â”€ All 3 showing "Online" in Fleet Manager

2. Ready to retry Task 5? âœ“
   â””â”€ Create FIS experiment
   â””â”€ Target instances (now FIS can find them!)
   â””â”€ Inject fault (CPU or Stop)
   â””â”€ Observe failure and recovery
   â””â”€ Collect evidence

3. Deliverables for Task 5:
   â””â”€ Screenshots: Before, During, Recovery, After
   â””â”€ CloudWatch metrics showing full timeline
   â””â”€ ASG Activity showing instance replacement
   â””â”€ Timeline of events with timestamps
   â””â”€ Analysis of failure and recovery time

Good luck! You're almost there! ðŸš€

================================================================================
REFERENCE: AWS DOCUMENTATION
================================================================================

For more info, see:

1. AWS Systems Manager Managed Instances
   https://docs.aws.amazon.com/systems-manager/latest/userguide/managed_instances.html

2. EC2 Instance Roles & Profiles
   https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html

3. AWS Fault Injection Simulator
   https://docs.aws.amazon.com/fis/latest/userguide/

4. Launch Template Documentation
   https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-launch-templates.html

================================================================================
